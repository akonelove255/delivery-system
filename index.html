
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á JIRANYA 2526</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body style="background-color:#f0fff4;">
  <div class="container py-4">
    <h3 class="mb-3">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á <b style="color:green">JIRANYA 2526</b></h3>

    <form id="form" class="row g-2">
      <div class="col-md-2"><input type="date" class="form-control" id="date" required /></div>
      <div class="col-md-2"><input type="text" class="form-control" id="customer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" required /></div>
      <div class="col-md-2"><input type="text" class="form-control" id="product" placeholder="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required /></div>
      <div class="col-md-1"><input type="number" class="form-control" id="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" required /></div>
      <div class="col-md-2"><input type="number" class="form-control" id="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢" required /></div>
      <div class="col-md-3"><input type="text" class="form-control" id="plate" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ" required /></div>

      <div class="col-md-3"><input type="text" class="form-control" id="statusDelivery" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" /></div>
      <div class="col-md-3">
        <select class="form-select" id="statusPayment">
          <option selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
          <option>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
          <option>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
        </select>
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-success w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>

    <hr />
    <h5>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
    <input type="text" id="search" class="form-control mb-2" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />

    <div class="table-responsive">
      <table class="table table-bordered table-hover table-sm bg-white">
        <thead class="table-success text-center">
          <tr>
            <th>#</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="align-middle"></tbody>
      </table>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbw_NCrm7xWewayAUPEk3aChWU-GMjgtp0Fjgy7adTOGCawPBQV3jCyooaswf5NVRdd6/exec";

    async function fetchData() {
      const res = await fetch(scriptURL);
      const data = await res.json();
      renderTable(data.records);
    }

    function renderTable(data) {
      const table = document.getElementById("tableBody");
      const search = document.getElementById("search").value.toLowerCase();
      table.innerHTML = "";
      let i = 1;
      data.forEach(row => {
        const values = Object.values(row).join("").toLowerCase();
        if (values.includes(search)) {
          table.innerHTML += `
            <tr>
              <td>${i++}</td>
              <td>${row.date}</td>
              <td>${row.customer}</td>
              <td>${row.product}</td>
              <td>${row.quantity}</td>
              <td>${row.price}</td>
              <td>${row.total}</td>
              <td>${row.plate}</td>
              <td>${row.delivery}</td>
              <td>${row.payment}</td>
              <td class="text-center">
                <button class="btn btn-sm btn-warning" onclick='editRow(${JSON.stringify(row)})'>‚úèÔ∏è</button>
                <button class="btn btn-sm btn-danger" onclick="deleteRow(${row.rowIndex})">üóë</button>
              </td>
            </tr>
          `;
        }
      });
    }

    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        action: "add",
        date: form.date.value,
        customer: form.customer.value,
        product: form.product.value,
        quantity: +form.quantity.value,
        price: +form.price.value,
        plate: form.plate.value,
        statusDelivery: form.statusDelivery.value,
        statusPayment: form.statusPayment.value,
      };
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data),
      });
      form.reset();
      fetchData();
    });

    function editRow(row) {
      Object.keys(row).forEach(k => {
        if (form[k]) form[k].value = row[k];
      });
      form.querySelector("button").innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï";
      form.onsubmit = async (e) => {
        e.preventDefault();
        const data = {
          action: "edit",
          rowIndex: row.rowIndex,
          id: row.id,
          date: form.date.value,
          customer: form.customer.value,
          product: form.product.value,
          quantity: +form.quantity.value,
          price: +form.price.value,
          plate: form.plate.value,
          statusDelivery: form.statusDelivery.value,
          statusPayment: form.statusPayment.value,
        };
        await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(data),
        });
        form.reset();
        form.querySelector("button").innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
        fetchData();
      };
    }

    async function deleteRow(rowIndex) {
      if (!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "delete", rowIndex }),
      });
      fetchData();
    }

    document.getElementById("search").addEventListener("input", fetchData);

    fetchData();
  </script>
</body>
</html>
