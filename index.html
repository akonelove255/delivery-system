
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-3 bg-light">

  <div class="container">
    <h3>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</h3>
    <form id="delivery-form" class="row g-2 mb-4">
      <div class="col-md-3"><input type="date" class="form-control" id="date" required></div>
      <div class="col-md-3"><input type="text" class="form-control" id="customer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" required></div>
      <div class="col-md-3"><input type="text" class="form-control" id="product" placeholder="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required></div>
      <div class="col-md-3"><input type="text" class="form-control" id="plate" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ" required></div>
      <div class="col-md-2"><input type="number" class="form-control" id="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" required></div>
      <div class="col-md-2"><input type="number" class="form-control" id="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢" required></div>
      <div class="col-md-2">
        <select class="form-select" id="delivery" required>
          <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
          <option value="‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
          <option value="‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" id="payment" required>
          <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</option>
          <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
          <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
        </select>
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-success w-100">‚òëÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>

    <h5>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
    <input id="search" class="form-control mb-2" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="renderTable()" />
    <div id="data-table"></div>
  </div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbw_NCrm7xWewayAUPEk3aChWU-GMjgtp0Fjgy7adTOGCawPBQV3jCyooaswf5NVRdd6/exec";
let rowsData = [];

document.getElementById("delivery-form").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    date: document.getElementById("date").value,
    customer: document.getElementById("customer").value,
    product: document.getElementById("product").value,
    quantity: document.getElementById("quantity").value,
    price: document.getElementById("price").value,
    plate: document.getElementById("plate").value,
    delivery: document.getElementById("delivery").value,
    payment: document.getElementById("payment").value,
    action: "add"
  };
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(res => res.text())
  .then(() => {
    e.target.reset();
    fetchData();
  });
});

function fetchData() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      rowsData = data.records;
      renderTable();
    });
}

function renderTable() {
  const keyword = document.getElementById("search").value.toLowerCase();
  let html = `<table class="table table-bordered table-sm table-striped">
    <thead class="table-success"><tr>
      <th>#</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏ß‡∏°</th>
      <th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr></thead><tbody>`;

  rowsData.filter(row => {
    return Object.values(row).some(val => String(val).toLowerCase().includes(keyword));
  }).forEach((row, i) => {
    const total = parseFloat(row.price || 0) * parseFloat(row.quantity || 0);
    html += `<tr>
      <td>${i + 1}</td>
      <td>${(row.date || "").split("T")[0]}</td>
      <td>${row.customer || ""}</td>
      <td>${row.product || ""}</td>
      <td>${row.quantity || ""}</td>
      <td>${row.price || ""}</td>
      <td>${total || 0}</td>
      <td>${row.plate || ""}</td>
      <td>${row.delivery || ""}</td>
      <td>${row.payment || ""}</td>
      <td>
        <button onclick="deleteRow(${i + 2})">üóë</button>
      </td>
    </tr>`;
  });

  html += "</tbody></table>";
  document.getElementById("data-table").innerHTML = html;
}

function deleteRow(rowIndex) {
  if (rowIndex <= 1) {
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏î‡πâ");
    return;
  }
  if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
    fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", rowIndex: rowIndex }),
      headers: {
        "Content-Type": "application/json"
      }
    })
    .then(res => res.text())
    .then(() => fetchData());
  }
}

fetchData();
</script>
</body>
</html>
