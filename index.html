
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { background: #f9fafa; padding: 2rem; }
    .form-control, .form-select { margin-bottom: 10px; }
    .table th, .table td { vertical-align: middle; }
  </style>
</head>
<body>
  <div class="container">
    <h3><i class="bi bi-box"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</h3>
    <div class="row">
      <div class="col-md-3"><input type="date" id="date" class="form-control" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"/></div>
      <div class="col-md-3"><input type="text" id="customer" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤"/></div>
      <div class="col-md-3"><input type="text" id="product" class="form-control" placeholder="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"/></div>
      <div class="col-md-3"><input type="text" id="plate" class="form-control" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ"/></div>
      <div class="col-md-2"><input type="number" id="quantity" class="form-control" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"/></div>
      <div class="col-md-2"><input type="number" id="price" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢"/></div>
      <div class="col-md-2">
        <select id="statusDelivery" class="form-select">
          <option value="" disabled selected>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
          <option>‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option><option>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
        </select>
      </div>
      <div class="col-md-2">
        <select id="statusPayment" class="form-select">
          <option value="" disabled selected>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</option>
          <option>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option><option>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
        </select>
      </div>
      <div class="col-md-2">
        <button onclick="submitData()" class="btn btn-success w-100">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
    <hr/>
    <h5><i class="bi bi-clipboard-data"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
    <input id="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="renderTable()" />
    <div class="table-responsive">
      <table class="table table-bordered table-striped mt-2" id="data-table"></table>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbw_NCrm7xWewayAUPEk3aChWU-GMjgtp0Fjgy7adTOGCawPBQV3jCyooaswf5NVRdd6/exec";
    let rowsData = [], editIndex = -1;

    function fetchData() {
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          rowsData = data.records;
          renderTable();
        });
    }

    function submitData() {
      const data = {
        date: document.getElementById("date").value,
        customer: document.getElementById("customer").value,
        product: document.getElementById("product").value,
        quantity: document.getElementById("quantity").value,
        price: document.getElementById("price").value,
        plate: document.getElementById("plate").value,
        statusDelivery: document.getElementById("statusDelivery").value,
        statusPayment: document.getElementById("statusPayment").value,
        action: editIndex === -1 ? "add" : "edit",
      };
      if (editIndex !== -1) {
        data.rowIndex = editIndex + 2;
        data.id = rowsData[editIndex].id;
      }

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      }).then(res => res.text()).then(() => {
        resetForm();
        fetchData();
      });
    }

    function renderTable() {
      const table = document.getElementById("data-table");
      const keyword = document.getElementById("search").value.toLowerCase();
      let html = "<thead class='table-success'><tr><th>#</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>";
      rowsData.filter(row =>
        Object.values(row).some(val => String(val).toLowerCase().includes(keyword))
      ).forEach((row, i) => {
        html += `<tr>
          <td>${i + 1}</td>
          <td>${formatDate(row.date)}</td>
          <td>${row.customer || ""}</td>
          <td>${row.product || ""}</td>
          <td>${row.quantity || ""}</td>
          <td>${row.price || ""}</td>
          <td>${row.total || ""}</td>
          <td>${row.plate || ""}</td>
          <td>${row.statusDelivery || ""}</td>
          <td>${row.statusPayment || ""}</td>
          <td>
            <button class='btn btn-sm btn-warning' onclick='editRow(${i})'>‚úèÔ∏è</button>
            <button class='btn btn-sm btn-danger' onclick='deleteRow(${i})'>üóë</button>
          </td>
        </tr>`;
      });
      table.innerHTML = html + "</tbody>";
    }

    function editRow(i) {
      const r = rowsData[i];
      document.getElementById("date").value = r.date;
      document.getElementById("customer").value = r.customer;
      document.getElementById("product").value = r.product;
      document.getElementById("quantity").value = r.quantity;
      document.getElementById("price").value = r.price;
      document.getElementById("plate").value = r.plate;
      document.getElementById("statusDelivery").value = r.statusDelivery;
      document.getElementById("statusPayment").value = r.statusPayment;
      editIndex = i;
    }

    function deleteRow(i) {
      const rowIndex = i + 2;
      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "delete", rowIndex }),
        headers: { "Content-Type": "application/json" }
      }).then(() => fetchData());
    }

    function resetForm() {
      document.querySelectorAll("input, select").forEach(el => el.value = "");
      editIndex = -1;
    }

    function formatDate(d) {
      if (!d) return "";
      return d.length > 10 ? new Date(d).toISOString().split("T")[0] : d;
    }

    fetchData();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.js"></script>
</body>
</html>
