
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á JIRANYA 2526</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { background: #eefaf1; font-family: 'Prompt', sans-serif; }
    .form-control, .form-select { margin-bottom: 10px; }
    .table th, .table td { vertical-align: middle; }
  </style>
</head>
<body>
<div class="container py-4">
  <h3>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á <b class="text-success">JIRANYA 2526</b></h3>
  <hr />
  <div class="card p-3 shadow-sm">
    <div class="row">
      <div class="col-md-6">
        <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" id="date" class="form-control" />
        <label>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <input type="text" id="product" class="form-control" />
        <label>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
        <input type="number" id="price" class="form-control" />
        <label>üì¶ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
        <input type="text" id="statusDelivery" class="form-control" />
      </div>
      <div class="col-md-6">
        <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
        <input type="text" id="customer" class="form-control" />
        <label>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
        <input type="number" id="quantity" class="form-control" />
        <label>üöó ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
        <input type="text" id="plate" class="form-control" />
        <label>üí≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
        <select id="statusPayment" class="form-select">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
          <option>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
          <option>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
        </select>
      </div>
    </div>
    <button onclick="reviewForm()" class="btn btn-success mt-3 w-100">üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <div id="preview" class="card mt-4 p-3 d-none">
    <h5>üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h5>
    <div id="previewContent"></div>
    <input type="hidden" id="rowIndex" />
    <input type="hidden" id="recordId" />
    <button onclick="submitToGoogleSheet()" class="btn btn-success">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button onclick="cancelEdit()" class="btn btn-secondary">‚ùé ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <hr />
  <h5>üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
  <input type="text" id="search" class="form-control mb-2" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="renderTable()" />
  <div id="data-table" class="table-responsive"></div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbw_NCrm7xWewayAUPEk3aChWU-GMjgtp0Fjgy7adTOGCawPBQV3jCyooaswf5NVRdd6/exec";
let rowsData = [];

function fetchData() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      rowsData = data.records;
      renderTable();
    });
}
fetchData();

function renderTable() {
  const table = document.getElementById("data-table");
  const keyword = document.getElementById("search").value.toLowerCase();
  let html = '<table class="table table-bordered table-sm table-striped">';
  html += `<thead class="table-success"><tr>
    <th>#</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>`;
  rowsData.filter(row => {
    return Object.values(row).some(val => String(val).toLowerCase().includes(keyword));
  }).forEach((row, i) => {
    html += `<tr>
      <td>${i + 1}</td>
      <td>${row.date || ""}</td>
      <td>${row.customer || ""}</td>
      <td>${row.product || ""}</td>
      <td>${row.quantity || ""}</td>
      <td>${row.price || ""}</td>
      <td>${row.total || ""}</td>
      <td>${row.plate || ""}</td>
      <td>${row.delivery || ""}</td>
      <td>${row.payment || ""}</td>
      <td>
        <button onclick='editRow(${JSON.stringify(row)})' class="btn btn-warning btn-sm">‚úèÔ∏è</button>
        <button onclick='deleteRow("${row.rowIndex}")' class="btn btn-danger btn-sm">üóë</button>
      </td></tr>`;
  });
  html += '</tbody></table>';
  table.innerHTML = html;
}

function reviewForm() {
  const data = getFormData();
  if (!data) return;
  let preview = "";
  for (const key in data) {
    if (key !== "rowIndex" && key !== "id")
      preview += `<p><b>${key}:</b> ${data[key]}</p>`;
  }
  document.getElementById("previewContent").innerHTML = preview;
  document.getElementById("preview").classList.remove("d-none");
}

function getFormData() {
  const fields = ["date", "customer", "product", "quantity", "price", "plate", "statusDelivery", "statusPayment"];
  const data = {};
  for (const id of fields) {
    const el = document.getElementById(id);
    if (!el.value) return Swal.fire("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    data[id.replace("status", "").toLowerCase()] = el.value;
  }
  data.total = parseFloat(data.price) * parseFloat(data.quantity);
  data.rowIndex = document.getElementById("rowIndex").value;
  data.id = document.getElementById("recordId").value || Date.now();
  return data;
}

function submitToGoogleSheet() {
  const data = getFormData();
  if (!data) return;
  const action = data.rowIndex ? "edit" : "add";
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ ...data, action }),
    headers: { "Content-Type": "application/json" },
  }).then(() => {
    Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "", "success");
    document.getElementById("preview").classList.add("d-none");
    clearForm(); fetchData();
  });
}

function clearForm() {
  ["date", "customer", "product", "quantity", "price", "plate", "statusDelivery", "statusPayment", "rowIndex", "recordId"].forEach(id => {
    document.getElementById(id).value = "";
  });
}

function cancelEdit() {
  document.getElementById("preview").classList.add("d-none");
}

function editRow(row) {
  document.getElementById("date").value = row.date;
  document.getElementById("customer").value = row.customer;
  document.getElementById("product").value = row.product;
  document.getElementById("quantity").value = row.quantity;
  document.getElementById("price").value = row.price;
  document.getElementById("plate").value = row.plate;
  document.getElementById("statusDelivery").value = row.delivery;
  document.getElementById("statusPayment").value = row.payment;
  document.getElementById("rowIndex").value = row.rowIndex;
  document.getElementById("recordId").value = row.id;
  reviewForm();
}

function deleteRow(rowIndex) {
  Swal.fire({
    title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?",
    showCancelButton: true,
    confirmButtonText: "‡∏•‡∏ö",
  }).then(result => {
    if (result.isConfirmed) {
      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "delete", rowIndex }),
        headers: { "Content-Type": "application/json" },
      }).then(() => {
        Swal.fire("‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "", "success");
        fetchData();
      });
    }
  });
}
</script>
</body>
</html>
